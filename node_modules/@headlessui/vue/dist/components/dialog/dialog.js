import{computed as o,defineComponent as b,h as D,inject as q,nextTick as le,onMounted as F,onUnmounted as re,provide as ae,ref as S,watchEffect as oe}from"vue";import{render as P,Features as K}from'../../utils/render.js';import{Keys as ne}from'../../keyboard.js';import{useId as T}from'../../hooks/use-id.js';import{FocusTrap as C}from'../../components/focus-trap/focus-trap.js';import{useInert as _}from'../../hooks/use-inert.js';import{Portal as U,PortalGroup as ie}from'../portal/portal.js';import{StackMessage as Y,useStackProvider as ue}from'../../internal/stack-context.js';import{match as z}from'../../utils/match.js';import{ForcePortalRoot as B}from'../../internal/portal-force-root.js';import{Description as se,useDescriptions as pe}from'../description/description.js';import{dom as L}from'../../utils/dom.js';import{useOpenClosed as fe,State as A}from'../../internal/open-closed.js';import{useOutsideClick as de}from'../../hooks/use-outside-click.js';import{getOwnerDocument as ce}from'../../utils/owner.js';import{useEventListener as ge}from'../../hooks/use-event-listener.js';import{Hidden as me,Features as ve}from'../../internal/hidden.js';import{useDocumentOverflowLockedEffect as De}from'../../hooks/document-overflow/use-document-overflow.js';var ye=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(ye||{});let I=Symbol("DialogContext");function E(r){let n=q(I,null);if(n===null){let l=new Error(`<${r} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,E),l}return n}let H="DC8F892D-2EBD-447C-A4C8-A03058436FF4",qe=b({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:H},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${T()}`}},emits:{close:r=>!0},setup(r,{emit:n,attrs:l,slots:p,expose:i}){var N;let a=S(!1);F(()=>{a.value=!0});let f=S(0),d=fe(),m=o(()=>r.open===H&&d!==null?(d.value&A.Open)===A.Open:r.open),v=S(null),R=S(null),O=o(()=>ce(v));if(i({el:v,$el:v}),!(r.open!==H||d!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof m.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${m.value===H?void 0:r.open}`);let c=o(()=>a.value&&m.value?0:1),k=o(()=>c.value===0),w=o(()=>f.value>1),$=q(I,null)!==null,G=o(()=>w.value?"parent":"leaf"),j=o(()=>d!==null?(d.value&A.Closing)===A.Closing:!1),V=o(()=>$||j.value?!1:k.value),J=o(()=>{var e,t,u;return(u=Array.from((t=(e=O.value)==null?void 0:e.querySelectorAll("body > *"))!=null?t:[]).find(s=>s.id==="headlessui-portal-root"?!1:s.contains(L(R))&&s instanceof HTMLElement))!=null?u:null});_(J,V);let Q=o(()=>w.value?!0:k.value),W=o(()=>{var e,t,u;return(u=Array.from((t=(e=O.value)==null?void 0:e.querySelectorAll("[data-headlessui-portal]"))!=null?t:[]).find(s=>s.contains(L(R))&&s instanceof HTMLElement))!=null?u:null});_(W,Q),ue({type:"Dialog",enabled:o(()=>c.value===0),element:v,onUpdate:(e,t)=>{if(t==="Dialog")return z(e,{[Y.Add]:()=>f.value+=1,[Y.Remove]:()=>f.value-=1})}});let X=pe({name:"DialogDescription",slot:o(()=>({open:m.value}))}),M=S(null),y={titleId:M,panelRef:S(null),dialogState:c,setTitleId(e){M.value!==e&&(M.value=e)},close(){n("close",!1)}};ae(I,y);function x(){var t,u,s;return[...Array.from((u=(t=O.value)==null?void 0:t.querySelectorAll("html > *, body > *, [data-headlessui-portal]"))!=null?u:[]).filter(g=>!(g===document.body||g===document.head||!(g instanceof HTMLElement)||g.contains(L(R))||y.panelRef.value&&g.contains(y.panelRef.value))),(s=y.panelRef.value)!=null?s:v.value]}let Z=o(()=>!(!k.value||w.value));de(()=>x(),(e,t)=>{y.close(),le(()=>t==null?void 0:t.focus())},Z);let ee=o(()=>!(w.value||c.value!==0));ge((N=O.value)==null?void 0:N.defaultView,"keydown",e=>{ee.value&&(e.defaultPrevented||e.key===ne.Escape&&(e.preventDefault(),e.stopPropagation(),y.close()))});let te=o(()=>!(j.value||c.value!==0||$));return De(O,te,e=>{var t;return{containers:[...(t=e.containers)!=null?t:[],x]}}),oe(e=>{if(c.value!==0)return;let t=L(v);if(!t)return;let u=new ResizeObserver(s=>{for(let g of s){let h=g.target.getBoundingClientRect();h.x===0&&h.y===0&&h.width===0&&h.height===0&&y.close()}});u.observe(t),e(()=>u.disconnect())}),()=>{let{id:e,open:t,initialFocus:u,...s}=r,g={...l,ref:v,id:e,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":M.value,"aria-describedby":X.value},h={open:c.value===0};return D(B,{force:!0},()=>[D(U,()=>D(ie,{target:v.value},()=>D(B,{force:!1},()=>D(C,{initialFocus:u,containers:x,features:k.value?z(G.value,{parent:C.features.RestoreFocus,leaf:C.features.All&~C.features.FocusLock}):C.features.None},()=>P({ourProps:g,theirProps:s,slot:h,attrs:l,slots:p,visible:c.value===0,features:K.RenderStrategy|K.Static,name:"Dialog"}))))),D(me,{features:ve.Hidden,ref:R})])}}}),Ke=b({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-overlay-${T()}`}},setup(r,{attrs:n,slots:l}){let p=E("DialogOverlay");function i(a){a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),p.close())}return()=>{let{id:a,...f}=r;return P({ourProps:{id:a,"aria-hidden":!0,onClick:i},theirProps:f,slot:{open:p.dialogState.value===0},attrs:n,slots:l,name:"DialogOverlay"})}}}),_e=b({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-backdrop-${T()}`}},inheritAttrs:!1,setup(r,{attrs:n,slots:l,expose:p}){let i=E("DialogBackdrop"),a=S(null);return p({el:a,$el:a}),F(()=>{if(i.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let{id:f,...d}=r,m={id:f,ref:a,"aria-hidden":!0};return D(B,{force:!0},()=>D(U,()=>P({ourProps:m,theirProps:{...n,...d},slot:{open:i.dialogState.value===0},attrs:n,slots:l,name:"DialogBackdrop"})))}}}),Ue=b({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${T()}`}},setup(r,{attrs:n,slots:l,expose:p}){let i=E("DialogPanel");p({el:i.panelRef,$el:i.panelRef});function a(f){f.stopPropagation()}return()=>{let{id:f,...d}=r,m={id:f,ref:i.panelRef,onClick:a};return P({ourProps:m,theirProps:d,slot:{open:i.dialogState.value===0},attrs:n,slots:l,name:"DialogPanel"})}}}),Ye=b({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:()=>`headlessui-dialog-title-${T()}`}},setup(r,{attrs:n,slots:l}){let p=E("DialogTitle");return F(()=>{p.setTitleId(r.id),re(()=>p.setTitleId(null))}),()=>{let{id:i,...a}=r;return P({ourProps:{id:i},theirProps:a,slot:{open:p.dialogState.value===0},attrs:n,slots:l,name:"DialogTitle"})}}}),ze=se;export{qe as Dialog,_e as DialogBackdrop,ze as DialogDescription,Ke as DialogOverlay,Ue as DialogPanel,Ye as DialogTitle};
